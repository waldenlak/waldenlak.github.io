var titleTime,OriginTitile=document.title;document.addEventListener("visibilitychange",(function(){document.hidden?(document.title="♥记得回来呐~~"+OriginTitile,clearTimeout(titleTime)):(document.title="✪ ▽ ✪ 被你发现啦！",titleTime=setTimeout((function(){document.title=OriginTitile}),2e3))})),catBarActive(),tagBarActive(),BarScroll();var dbAPI="https://douban-api.edui.fun/",diAPI="https://api.wmdb.tv/movie/api/generateimage?doubanId=",dbA=document.querySelectorAll(".post-content a[href*='douban.com/subject/']:not([rel='noreferrer'])")||"";if(dbA)for(var i=0;i<dbA.length;i++){_this=dbA[i];var dbHref=_this.href,db_reg=/^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/,db_type=dbHref.replace(db_reg,"$1"),db_id=dbHref.replace(db_reg,"$2").toString();if("movie"==db_type){var this_item="movie"+db_id,url=diAPI+db_id+"&lang=Cn";null==localStorage.getItem(this_item)||"undefined"==localStorage.getItem(this_item)?fetchDB("movies","https://movie.douban.com/subject/",url,movieShow):movieShow(dbHref,this_item)}else if("book"==db_type){this_item="book"+db_id,url=dbAPI+"v2/book/id/"+db_id;null==localStorage.getItem(this_item)||"undefined"==localStorage.getItem(this_item)?fetchDB("book","https://book.douban.com/subject/",url,bookShow):bookShow(dbHref,this_item)}}async function fetchDB(e,t,i,o){try{const a=await fetch(i),r=await a.json();let c=e+r.id,n=t+r.id+"/";localStorage.setItem(c,JSON.stringify(r)),await o(n,c)}catch(e){console.log("匹配出错:",e)}}async function movieShow(e,t){var i=localStorage.getItem(t),o="<div class='dbview'><img referrer-policy='no-referrer' loading='lazy' class='dbview-image' src=https://imageserver.querydata.org/api?url="+JSON.parse(i).image+"&width=200&format=webp></div>",a=document.createElement("div"),r=".post-content a[href='"+e+"']",c=document.querySelector(r);c.parentNode.replaceChild(a,c),a.innerHTML=o}function bookShow(e,t){var i=localStorage.getItem(t),o=JSON.parse(i),a=Math.ceil(o.rating.average),r="<div class='dbview'><div class='dbview-meta'><div class='dbview-middle'><h4 class='dbview-title'><a target='_blank' href='"+e+"'>《"+o.title+"》</a></h4><div class='rating'><div class='rating-star allstar"+a+"'></div><div class='rating-average'>"+o.rating.average+"</div></div><time class='dbview-date'>"+o.author+" </time><section style='max-height:75px;overflow:hidden;' class='dbview-excerpt'>"+o.summary.replace(/\s*/g,"")+"</section></div></div><img referrer-policy='no-referrer' loading='lazy' class='dbview-image' src="+o.images.medium+"></div>",c=document.createElement("div"),n=".post-content a[href='"+e+"']",l=document.querySelector(n);l.parentNode.replaceChild(c,l),c.innerHTML=r}const kCards=document.querySelectorAll(".tagk .k-card #favi");let o=[["icon.horse/icon/"],["logo.clearbit.com/"],["www.google.com/s2/favicons?domain="]];async function favURL(e){for(var t=0;t<o.length;t++)for(var i=o[t],a=new URL(e).hostname,r=0;r<i.length;r++){var c=`https://${i[r]}${a}`;try{if((await fetch(c)).ok)return c}catch(e){console.log("匹配出错:",e)}}return null}function catBarActive(){var e=window.location.pathname;if("/"==(e=decodeURIComponent(e)))document.querySelector("#catbar")&&document.getElementById("hom").classList.add("select");else if(/\/categories\/.*?\//.test(e)){var t=e.split("/")[2];document.querySelector("#catbar")&&document.getElementById(t).classList.add("select")}}function tagBarActive(){var e=window.location.pathname;if("/"==(e=decodeURIComponent(e)))document.querySelector("#tagbar")&&document.getElementById("hom").classList.add("select");else if(/\/tags\/.*?\//.test(e)){var t=e.split("/")[2];document.querySelector("#tagbar")&&document.getElementById(t).classList.add("select")}}function BarScroll(){if(document.getElementById("bar-item")){let e=document.getElementById("bar-item");e.addEventListener("mousewheel",(function(t){let i=-t.wheelDelta/2;e.scrollLeft+=i,t.preventDefault()}),!1)}}kCards.forEach((async function(e){var t=e.getAttribute("href");if(document.querySelectorAll(".post-content .k-card")){var i=await favURL(t);if(null!=i){var o=e.querySelector(".coverr");o.setAttribute("src",i),o.onerror=function(){o.setAttribute("src",t)}}else o.setAttribute("src",t)}}));