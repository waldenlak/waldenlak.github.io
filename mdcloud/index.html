<!DOCTYPE html>
<html lang="zh">
    <head title="MD Editor">
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="css/editormd.min.css"/>
        <style>
            html, body {width: 100%;height: 100%;margin: 0;background: #edecfd;}
            .editormd {box-sizing: border-box;}
        </style>
    </head>
    <body>
        <div id="editor">
            <!-- Tips: Editor.md can auto append a `<textarea>` tag -->
            <textarea style="display:none;"></textarea>
        </div>
        <script src="js/jquery.min.js"></script>
        <script src="js/editormd.min.js"></script>
        <script type="text/javascript">
            $(function () {
                var content = window.localStorage.getItem("KEY_MDCLOUD_CONTENT");
                window.mdcloud = editormd("editor", {
                    editorTheme: 'neo',
                    width: "100%",
                    height: "98%",
                    // markdown: "xxxx",     // dynamic set Markdown text
                    path : "lib/",  // Autoload modules mode, codemirror, marked... dependents libs path
                    toolbarIcons: function() {
                        var icons = editormd.toolbarModes.full;
                        icons = icons.filter(function (i) {return !['fullscreen', 'preview', 'emoji'].includes(i);});
                        icons.push('|', 'load_md');
                        return icons;
                    },
                    toolbarCustomIcons : {
                        load_md: '<input type="file" id="my_file" accept=".md" onchange="md_file_changed()" style="display: none;"><li><a href="javascript:#" onclick="load_md_file()" title="load md" unselectable="on"><i class="fa fa-upload" name="load_md" unselectable="on"></i></a></li>',
                    },
                    lang: {
                        toolbar: {
                        load_md : "上传本地md文件",
                        }
                    },
                });
                window.load_md_file = function () {
                    $("#my_file").click();
                }
                window.md_file_changed = function () {
                    var file = document.getElementById("my_file").files[0];
                    var reader = new FileReader();
                    reader.readAsText(file, "utf-8");
                    reader.onload = function (e) {
                        var fileText = e.target.result;
                        window.mdcloud.cm.setValue(fileText);
                    }
                }
                // 每隔10秒将编辑器中的内容保存到LocalStorage中
                setInterval(function () {
                    window.localStorage.setItem("KEY_MDCLOUD_CONTENT", window.mdcloud.cm.getValue());
                }, 1000 * 10);
            });
        </script>
    </body>
</html>